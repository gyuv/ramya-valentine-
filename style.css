window.addEventListener("load", function () {

gsap.registerPlugin(MotionPathPlugin);

// Intro animation
gsap.to(".title",{opacity:1,y:-20,duration:2});
gsap.to(".subtitle",{opacity:1,delay:1,duration:2});

// Timeline stagger reveal
const moments=document.querySelectorAll(".moment");

function revealMoments(){
 moments.forEach((el,i)=>{
  const rect=el.getBoundingClientRect();
  if(rect.top<window.innerHeight*0.85){
    gsap.to(el,{
      opacity:1,
      y:0,
      duration:1.2,
      delay:i*0.2,
      ease:"power3.out"
    });
  }
 });
}

window.addEventListener("scroll",revealMoments);

// Runner scroll control
window.addEventListener("scroll",function(){
 const progress=window.scrollY/
 (document.body.scrollHeight-window.innerHeight);
 gsap.to(".runner",{x:progress*(window.innerWidth-150),duration:0.3});
});

// Flight animation
const path=document.querySelector("#flightPath");
const plane=document.querySelector("#plane");

gsap.set(plane,{
 motionPath:{path:path,align:path,autoRotate:true}
});

window.addEventListener("scroll",function(){
 const progress=window.scrollY/
 (document.body.scrollHeight-window.innerHeight);
 gsap.to(plane,{
   motionPath:{path:path,align:path,autoRotate:true},
   duration:0.5,
   ease:"none",
   progress:progress
 });
});

// Fireworks (single trigger)
let fired=false;
const canvas=document.getElementById("fireworks");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

function launchFireworks(){
 for(let i=0;i<150;i++){
  let x=canvas.width/2;
  let y=canvas.height/2;
  let vx=(Math.random()-0.5)*8;
  let vy=(Math.random()-0.5)*8;
  animateParticle(x,y,vx,vy);
 }
}

function animateParticle(x,y,vx,vy){
 let life=100;
 function draw(){
  if(life<=0) return;
  ctx.fillStyle="rgba(255,215,0,0.8)";
  ctx.fillRect(x,y,3,3);
  x+=vx;
  y+=vy;
  life--;
  requestAnimationFrame(draw);
 }
 draw();
}

window.addEventListener("scroll",function(){
 if(window.innerHeight+window.scrollY>=document.body.offsetHeight-10 && !fired){
  fired=true;
  launchFireworks();
  gsap.to(".couple",{opacity:1,duration:2});
 }
});

// Countdown
const target=new Date("August 15, 2026 00:00:00").getTime();
const countdown=document.getElementById("countdown");

setInterval(function(){
 const now=new Date().getTime();
 const diff=target-now;
 const days=Math.floor(diff/(1000*60*60*24));
 const hours=Math.floor((diff%(1000*60*60*24))/(1000*60*60));
 const mins=Math.floor((diff%(1000*60*60))/(1000*60));
 const secs=Math.floor((diff%(1000*60))/1000);

 countdown.innerHTML=
 `Anniversary Countdown ❤️<br>
 ${days} Days ${hours} Hrs ${mins} Min ${secs} Sec`;
},1000);

});
